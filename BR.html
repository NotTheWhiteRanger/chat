function initMultiplayer() {
  connectionStatus.textContent = "Status: Connecting...";
  socket = io("https://game.kcschat.org", {
    transports: ["websocket"],
    secure: true
  });

  socket.on("connect", () => {
    console.log("Connected to server with id:", socket.id);
    connectionStatus.textContent = "Status: Connected";
  });

  socket.on("disconnect", () => {
    console.log("Disconnected from server");
    connectionStatus.textContent = "Status: Disconnected";
  });

  socket.on("currentId", (id) => {
    localPlayerId = id;
  });

  socket.on("currentPlayers", (players) => {
    for (let id in players) {
      if (id === localPlayerId) continue;
      remotePlayers[id] = players[id];
    }
  });

  socket.on("newPlayer", (playerData) => {
    if (playerData.id !== localPlayerId) {
      remotePlayers[playerData.id] = playerData;
      console.log("New player joined:", playerData.id);
    }
  });

  socket.on("playerMoved", (data) => {
    if (data.id !== localPlayerId) {
      if (remotePlayers[data.id]) {
        remotePlayers[data.id].x = data.x;
        remotePlayers[data.id].y = data.y;
        remotePlayers[data.id].angle = data.angle;
        remotePlayers[data.id].weapon = data.weapon;
        remotePlayers[data.id].score = data.score;
      } else {
        remotePlayers[data.id] = data;
      }
    }
  });

  socket.on("playerDisconnected", (id) => {
    delete remotePlayers[id];
    console.log("Player disconnected:", id);
  });

  socket.on("playerShot", (data) => {
    if (data.id !== localPlayerId) {
      remoteBullets.push({ ...data.bullet, owner: data.id });
    }
  });
}

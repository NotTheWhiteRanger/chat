<!-- ... (rest of your HTML remains unchanged) ... -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
  import { getDatabase, ref, push, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD2B6KZgtYQPE4K-JF5GQszp5wjNgX6_MY",
    authDomain: "new-chat-8d4f4.firebaseapp.com",
    databaseURL: "https://new-chat-8d4f4-default-rtdb.firebaseio.com",
    projectId: "new-chat-8d4f4",
    storageBucket: "new-chat-8d4f4.firebasestorage.app",
    messagingSenderId: "825077448854",
    appId: "1:825077448854:web:3906174c00e1f6604782b7"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  let currentUsername = "Anonymous";
  let unreadCount = 0;

  const loginContainer = document.getElementById("loginContainer");
  const emailInput = document.getElementById("emailInput");
  const passwordInput = document.getElementById("passwordInput");
  const signInBtn = document.getElementById("signInBtn");
  const loginBtn = document.getElementById("loginBtn");

  // Check localStorage for 8-hour login
  function isLoggedIn() {
    const loginTime = localStorage.getItem("loginTime");
    if (!loginTime) return false;
    const eightHours = 8 * 60 * 60 * 1000;
    return (Date.now() - loginTime) < eightHours;
  }

  window.addEventListener("load", () => {
    if (isLoggedIn()) {
      loginContainer.style.display = "none";
    } else {
      loginContainer.style.display = "block";
    }
  });

  // Show login form on "Login" click if not already valid
  loginBtn.addEventListener("click", (e) => {
    e.preventDefault();
    if (!isLoggedIn()) {
      loginContainer.style.display = "block";
    } else {
      alert("Already logged in!");
    }
  });

  // Sign in logic with random sound effect for Bobby
  signInBtn.addEventListener("click", () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    signInWithEmailAndPassword(auth, email, password)
      .then(() => {
        currentUsername = email.split("@")[0];
        alert("Signed in as " + currentUsername + "!");
        localStorage.setItem("loginTime", Date.now());
        loginContainer.style.display = "none";

        // If bobby@kennedycsi.com logs in, play a random sound effect immediately 
        // and every 3 minutes if he's on the index page.
        if (email.toLowerCase() === "bobby@kennedycsi.com") {
          const playRandomEffect = () => {
            const randomEffectNumber = Math.floor(Math.random() * 10) + 1;
            const audio = new Audio("images/effect" + randomEffectNumber + ".mp3");
            audio.play();
          };
          // Play one immediately
          playRandomEffect();
          // Check if on the index page and schedule a sound every 3 minutes
          if (window.location.pathname.endsWith("index.html") || window.location.pathname === "/") {
            setInterval(playRandomEffect, 180000); // 180,000 ms = 3 minutes
          }
        }
      })
      .catch((error) => {
        alert("Sign-in failed: " + error.message);
      });
  });

  // Search bar logic with added "Hacker" trigger
  const searchBar = document.getElementById("searchBar");
  searchBar.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      if (searchBar.value === "CrewhuScammedUs") {
        window.location.href = "encryptionTool.html";
      } else if (searchBar.value === "SecretChat") {
        window.location.href = "encryptchat.html";
      } else if (searchBar.value === "Hacker") {
        window.location.href = "HackOrBeHacked.html";
      }
    }
  });

  // Chat logic
  const chatModal = document.getElementById("chatModal");
  const closeChat = document.getElementById("closeChat");
  const chatLink = document.getElementById("chatLink");
  const chatLog = document.getElementById("chatLog");
  const chatMessage = document.getElementById("chatMessage");
  const sendChat = document.getElementById("sendChat");
  const clearFirebaseChat = document.getElementById("clearFirebaseChat");
  const unreadBadge = document.getElementById("unreadBadge");

  chatLink.addEventListener("click", (e) => {
    e.preventDefault();
    if (currentUsername === "Anonymous" && !isLoggedIn()) {
      alert("Please sign in to chat.");
      return;
    }
    chatModal.style.display = "block";
    unreadCount = 0;
    updateUnreadBadge();
  });

  closeChat.addEventListener("click", () => {
    chatModal.style.display = "none";
  });

  window.addEventListener("click", (event) => {
    if (event.target === chatModal) {
      chatModal.style.display = "none";
    }
  });

  sendChat.addEventListener("click", () => {
    if (currentUsername === "Anonymous" && !isLoggedIn()) {
      alert("Please sign in to chat.");
      return;
    }
    const message = chatMessage.value.trim();
    if (!message) return;
    const timeStamp = new Date().toLocaleTimeString();
    const chatData = { username: currentUsername, message, time: timeStamp };
    push(ref(db, "chat"), chatData);
    chatMessage.value = "";
  });

  chatMessage.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      sendChat.click();
    }
  });

  function updateUnreadBadge() {
    if (unreadCount > 0) {
      unreadBadge.textContent = unreadCount;
      unreadBadge.style.display = "inline-block";
    } else {
      unreadBadge.style.display = "none";
    }
  }

  onChildAdded(ref(db, "chat"), (snapshot) => {
    const data = snapshot.val();
    const messageElem = document.createElement("div");
    messageElem.classList.add("chat-message");
    if (data.username === currentUsername) {
      messageElem.classList.add("sent");
      messageElem.textContent = data.message;
    } else {
      messageElem.classList.add("received");
      messageElem.textContent = data.username + ": " + data.message;
    }
    const timeSpan = document.createElement("span");
    timeSpan.classList.add("timestamp");
    timeSpan.textContent = data.time;
    messageElem.appendChild(timeSpan);
    chatLog.appendChild(messageElem);
    chatLog.scrollTop = chatLog.scrollHeight;
    if (chatModal.style.display !== "block") {
      unreadCount++;
      updateUnreadBadge();
    }
  });

  clearFirebaseChat.addEventListener("click", () => {
    remove(ref(db, "chat"))
      .then(() => {
        chatLog.innerHTML = "";
      })
      .catch((error) => {
        console.error("Error clearing chat history:", error);
      });
  });

  // Invert button
  const invertBtn = document.getElementById("invertBtn");
  invertBtn.addEventListener("click", () => {
    document.body.classList.toggle("inverted");
  });

  // Guns link overlay
  document.getElementById("gunsLink").addEventListener("click", function(e) {
    e.preventDefault();
    const overlay = document.createElement("div");
    overlay.style.cssText =
      "position: fixed; top: 0; left: 0; width: 100%; height: 100%;" +
      "background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 3000;";
    const iframe = document.createElement("iframe");
    iframe.src = "Guns/quick_draw.html";
    iframe.style.cssText = "width: 90%; height: 90%; border: none; border-radius: 8px;";
    overlay.appendChild(iframe);
    document.body.appendChild(overlay);
    overlay.addEventListener("click", function(e) {
      if (e.target === overlay) {
        document.body.removeChild(overlay);
      }
    });
  });
</script>
<!-- ... (rest of your HTML remains unchanged) ... -->

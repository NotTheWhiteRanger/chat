<!-- (Everything above remains unchanged) -->

<main>
  <h3>Welcome to the Cats & Guns Community</h3>
  <p>Here at Cats & Guns Central, we combine our two passions: adorable felines and high-powered firearms.</p>
  <p>Explore our gallery of cat images, chat with fellow enthusiasts, and learn more about our unique community.</p>
  <p>Click "Chat" above to talk with others about your favorite cat memes and firearms!</p>
  <!-- Existing Buttons -->
  <button onclick="window.location.href='BR.html'">Start Battle Royale</button>
  <button onclick="window.location.href='casino.html'">Enter Casino</button>

  <!-- MTG Play Button + User Status -->
  <p id="userStatus" style="margin-top: 10px; font-weight: bold;"></p>
  <button id="mtgCommanderBtn">Play MTG Commander</button>
</main>

<!-- Firebase, Auth & Chat Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
  import { getDatabase, ref, push, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD2B6KZgtYQPE4K-JF5GQszp5wjNgX6_MY",
    authDomain: "new-chat-8d4f4.firebaseapp.com",
    databaseURL: "https://new-chat-8d4f4-default-rtdb.firebaseio.com",
    projectId: "new-chat-8d4f4",
    storageBucket: "new-chat-8d4f4.firebasestorage.app",
    messagingSenderId: "825077448854",
    appId: "1:825077448854:web:3906174c00e1f6604782b7"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  let currentUsername = "Anonymous";
  let unreadCount = 0;

  const loginContainer = document.getElementById("loginContainer");
  const emailInput = document.getElementById("emailInput");
  const passwordInput = document.getElementById("passwordInput");
  const signInBtn = document.getElementById("signInBtn");
  const loginBtn = document.getElementById("loginBtn");
  const mtgBtn = document.getElementById("mtgCommanderBtn");
  const userStatus = document.getElementById("userStatus");

  function isLoggedIn() {
    const loginTime = localStorage.getItem("loginTime");
    if (!loginTime) return false;
    const eightHours = 8 * 60 * 60 * 1000;
    return (Date.now() - loginTime) < eightHours;
  }

  window.addEventListener("load", () => {
    if (isLoggedIn()) {
      loginContainer.style.display = "none";
    } else {
      loginContainer.style.display = "block";
    }
  });

  loginBtn.addEventListener("click", (e) => {
    e.preventDefault();
    if (!isLoggedIn()) {
      loginContainer.style.display = "block";
    } else {
      alert("Already logged in!");
    }
  });

  function playRandomSound() {
    const soundIndex = Math.floor(Math.random() * 10) + 1;
    const audio = new Audio('images/effect' + soundIndex + '.mp3');
    audio.play().catch(error => console.error("Error playing sound:", error));
  }

  signInBtn.addEventListener("click", () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    signInWithEmailAndPassword(auth, email, password)
      .then(() => {
        currentUsername = email.split("@")[0];
        alert("Signed in as " + currentUsername + "!");
        localStorage.setItem("loginTime", Date.now());
        loginContainer.style.display = "none";
        if(email.toLowerCase() === "bobby@kennedycsi.com") {
          playRandomSound();
          setInterval(playRandomSound, 180000);
        }
      })
      .catch((error) => {
        alert("Sign-in failed: " + error.message);
      });
  });

  // MTG Commander Access
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUsername = user.email.split("@")[0];
      userStatus.textContent = `Signed in as: ${currentUsername}`;
      loginContainer.style.display = "none";
      localStorage.setItem("loginTime", Date.now());
    } else {
      currentUsername = "Anonymous";
      userStatus.textContent = "Not signed in";
    }
  });

  mtgBtn.addEventListener("click", () => {
    const user = auth.currentUser;
    if (user && isLoggedIn()) {
      window.location.href = "Magic/Public/mtgPlaymat.html";
    } else {
      alert("Please sign in to access the MTG Commander playmat.");
    }
  });
</script>

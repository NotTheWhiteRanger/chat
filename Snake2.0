<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Multiplayer Snake Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f0f0f0;
    }
    canvas {
      background: #000;
      display: block;
      margin: 20px auto;
      border: 1px solid #ccc;
    }
    #game-container, #multiplayer-container {
      display: none;
    }
    #leaderboard, #settings {
      margin-top: 20px;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
    }
    #night-mode {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <h1>Multiplayer Snake Game</h1>
  <button id="night-mode">Toggle Night Mode</button>
  <div id="multiplayer-container">
    <button onclick="createRoom()">Create Room</button>
    <input type="text" id="room-id" placeholder="Enter Room ID">
    <button onclick="joinRoom(document.getElementById('room-id').value)">Join Room</button>
    <p id="room-display"></p>
  </div>
  <div id="game-container">
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    <p>Score: <span id="score">0</span></p>
  </div>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyD2B6KZgtYQPE4K-JF5GQszp5wjNgX6_MY",
      authDomain: "new-chat-8d4f4.firebaseapp.com",
      databaseURL: "https://new-chat-8d4f4-default-rtdb.firebaseio.com/",
      projectId: "new-chat-8d4f4",
      storageBucket: "new-chat-8d4f4.appspot.com",
      messagingSenderId: "825077448854",
      appId: "1:825077448854:web:YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const database = firebase.database();
    let roomId = null;
    let playerNumber = null;
    let snake = [{ x: 160, y: 160 }];
    let food = { x: 100, y: 100 };
    
    function createRoom() {
      roomId = Math.random().toString(36).substring(2, 7);
      database.ref(`multiplayer/${roomId}`).set({
        player1: { x: 160, y: 160, score: 0 },
        food: { x: getRandomPosition(), y: getRandomPosition() }
      });
      playerNumber = "player1";
      startMultiplayerGame();
    }

    function joinRoom(room) {
      roomId = room;
      database.ref(`multiplayer/${room}`).once("value", snapshot => {
        if (!snapshot.child("player2").exists()) {
          database.ref(`multiplayer/${room}`).update({
            player2: { x: 200, y: 200, score: 0 }
          });
          playerNumber = "player2";
          startMultiplayerGame();
        } else {
          alert("Room is full!");
        }
      });
    }

    function getRandomPosition() {
      return Math.floor(Math.random() * (canvas.width / 20)) * 20;
    }

    document.addEventListener("keydown", (e) => {
      let update = {};
      if (e.key === "ArrowLeft") { update = { x: snake[0].x - 20 }; }
      else if (e.key === "ArrowRight") { update = { x: snake[0].x + 20 }; }
      else if (e.key === "ArrowUp") { update = { y: snake[0].y - 20 }; }
      else if (e.key === "ArrowDown") { update = { y: snake[0].y + 20 }; }
      database.ref(`multiplayer/${roomId}/${playerNumber}`).update(update);
    });

    database.ref(`multiplayer/${roomId}`).on("value", snapshot => {
      if (snapshot.exists()) {
        let data = snapshot.val();
        snake = [{ x: data[playerNumber].x, y: data[playerNumber].y }];
        let opponentKey = playerNumber === "player1" ? "player2" : "player1";
        if (data[opponentKey]) {
          drawOpponent(data[opponentKey].x, data[opponentKey].y);
        }
      }
    });

    function drawOpponent(x, y) {
      ctx.fillStyle = "blue";
      ctx.fillRect(x, y, 18, 18);
    }

    function startMultiplayerGame() {
      gameLoop();
    }

    function gameLoop() {
      requestAnimationFrame(gameLoop);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "green";
      snake.forEach(segment => ctx.fillRect(segment.x, segment.y, 18, 18));
    }

    startMultiplayerGame();
  </script>
</body>
</html>

// Listen for arrow key and WASD key presses to control the snake
document.addEventListener("keydown", (e) => {
  // Prevent multiple rapid changes in one frame
  if (changingDirection) return;
  
  // Store the new direction values temporarily
  let newDx = dx;
  let newDy = dy;
  
  // Check for arrow keys or WASD controls (using toLowerCase for letters)
  if ((e.key === "ArrowLeft" || e.key.toLowerCase() === "a") && dx === 0) {
    newDx = -grid; newDy = 0;
  } else if ((e.key === "ArrowRight" || e.key.toLowerCase() === "d") && dx === 0) {
    newDx = grid; newDy = 0;
  } else if ((e.key === "ArrowUp" || e.key.toLowerCase() === "w") && dy === 0) {
    newDx = 0; newDy = -grid;
  } else if ((e.key === "ArrowDown" || e.key.toLowerCase() === "s") && dy === 0) {
    newDx = 0; newDy = grid;
  }
  
  // Prevent reversing direction directly
  if (newDx === -dx && newDy === -dy) return;
  
  // Update the direction and set the flag so that further changes won't register until the frame is done.
  dx = newDx;
  dy = newDy;
  changingDirection = true;
});
